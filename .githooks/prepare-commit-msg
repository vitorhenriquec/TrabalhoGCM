#!/bin/sh

echo "checagem do commit..."

MENSAGEM="$(cat $1)"
PADRAO="^#[0-9]+"
NUMERO_ISSUE="$(echo $MENSAGEM | grep -o -E '[0-9]+')"

if [[ $MENSAGEM ~= $PADRAO ]]; then
	echo "Commit não está no padrão!"
	exit 0;
else
	echo "Não foi atribuído um número de issue ao commit!"
	exit 0;
fi

CURL_ARGS="-f -s -S -k"
API_URL="https://api.github.com/repos/vitorhenriquec/TrabalhoGCM/issues/$NUMERO_ISSUE"
JSON="$(curl $CURL_ARGS $API_URL)"

echo "$JSON"

if [[ $JSON.state == "open" ]]; then
	echo "Issue aberta encontrada"
else
	echo "Issue não encontrada ou não aberta"
	exit 0;
fi

exit 1;